> 原文地址 [www.cnblogs.com](https://www.cnblogs.com/gucb/p/12880466.html)

### 介绍

UFW 或 Uncomplicated Firewall 是`iptables`一个接口，旨在简化配置防火墙的过程。 虽然`iptables`是一个可靠而灵活的工具，但初学者很难学会如何使用它来正确配置防火墙。 如果您希望开始保护网络并且不确定使用哪种工具，UFW 可能是您的正确选择。

本教程将向您展示如何在 Debian 10 上使用 UFW 设置防火墙。

先决条件
----

要学习本教程，您需要一台带有`sudo`非 root 用户的 Debian 10 服务器，您可以按照 [Debian 10 初始服务器设置教程](https://www.howtoing.com/initial-server-setup-with-debian-10/)中的第 1 步 - 3 进行[设置](https://www.howtoing.com/initial-server-setup-with-debian-10/) 。

第 1 步 - 安装 UFW
--------------

Debian 默认不安装 UFW。 如果您遵循整个[初始服务器安装教程](https://www.howtoing.com/initial-server-setup-with-debian-10/) ，则您将安装并启用 UFW。 如果没有，请使用`apt`立即安装：

```
sudo apt install ufw
```

我们将设置 UFW 并按以下步骤启用它。

第 2 步 - 将 IPv6 与 UFW 一起使用（可选）
-----------------------------

本教程是以 IPv4 编写的，但只要您启用它就适用于 IPv6。 如果您的 Debian 服务器启用了 IPv6，您需要确保将 UFW 配置为支持 IPv6; 这将确保 UFW 除了 IPv4 之外还将管理 IPv6 的防火墙规则。 要配置它，请使用`nano`或您喜欢的编辑器打开 UFW 配置文件`/etc/default/ufw` ：

```
sudo nano /etc/default/ufw
```

然后确保`IPV6`值为`yes` 。 它应该如下所示：

/ etc / default / ufw 摘录

```
IPV6=yes
```

保存并关闭文件。 现在，当启用 UFW 时，它将配置为同时写入 IPv4 和 IPv6 防火墙规则。 但是，在启用 UFW 之前，您需要确保将防火墙配置为允许您通过 SSH 进行连接。 让我们从设置默认策略开始。

第 3 步 - 设置默认策略
--------------

如果您刚开始使用防火墙，则要定义的第一个规则是您的默认策略。 这些规则处理未明确匹配任何其他规则的流量。默认情况下，UFW 设置为拒绝所有传入连接并允许所有传出连接。 这意味着任何尝试访问您服务器的人都无法连接，而服务器中的任何应用程序都可以访问外部世界。

让我们将您的 UFW 规则设置回默认值，以便我们确保您能够按照本教程进行操作。 要设置 UFW 使用的默认值，请使用以下命令：

```
sudo ufw default deny incoming
sudo ufw default allow outgoing
```

这些命令将默认值设置为拒绝传入并允许传出连接。 仅这些防火墙默认值可能足以用于个人计算机，但服务器通常需要响应来自外部用户的传入请求。 我们接下来会调查一下。

第 4 步 - 允许 SSH 连接
-----------------

如果我们现在启用了我们的 UFW 防火墙，它将拒绝所有传入的连接。 这意味着，如果我们希望服务器响应这些类型的请求，我们将需要创建明确允许合法传入连接的规则 - 例如 SSH 或 HTTP 连接。 如果您使用的是云服务器，则可能需要允许传入的 SSH 连接，以便连接和管理服务器。

要将服务器配置为允许传入 SSH 连接，可以使用以下命令：

```
sudo ufw allow ssh
```

这将创建防火墙规则，允许端口`22`上的所有连接，这是 SSH 守护程序默认监听的端口。 UFW 知道什么端口`allow ssh`意思，因为它在`/etc/services`文件中列为`/etc/services` 。

但是，我们实际上可以通过指定端口而不是服务名来编写等效规则。 例如，此命令产生与上面相同的结果：

```
sudo ufw allow 22
```

如果将 SSH 守护程序配置为使用其他端口，则必须指定相应的端口。 例如，如果 SSH 服务器正在监听端口`2222` ，则可以使用此命令允许该端口上的连接：

```
sudo ufw allow 2222
```

现在您的防火墙已配置为允许传入 SSH 连接，您可以启用它。

第 5 步 - 启用 UFW
--------------

要启用 UFW，请使用以下命令：

```
sudo ufw enable
```

您将收到一条警告，指出该命令可能会破坏现有的 SSH 连接。 我们已经设置了允许 SSH 连接的防火墙规则，因此可以继续。 用`y`回应提示`ENTER` 。

防火墙现在处于活动状态。 运行`sudo ufw status verbose`命令以查看已设置的规则。 本教程的其余部分将介绍如何更详细地使用 UFW，包括允许和拒绝不同类型的连接。

第 6 步 - 允许其他连接
--------------

此时，您应该允许服务器需要的所有其他连接正常运行。 您应该允许的连接取决于您的特定需求。 幸运的是，您已经知道如何编写允许基于服务名称或端口的连接的规则; 我们已经在端口`22`上为 SSH 做了这个。 你也可以这样做：

*   端口`80`上的 HTTP，这是未加密的 Web 服务器使用的。 要允许此类流量，您可以键入`sudo ufw allow http`或`sudo ufw allow 80` 。
*   端口`443`上的 HTTPS，这是加密的 Web 服务器使用的。 要允许此类流量，您可以键入`sudo ufw allow https`或`sudo ufw allow 443` 。

但是，除了指定端口或已知服务之外，还有其他方法可以允许连接。 我们将讨论下一步。

### 特定端口范围

您可以使用 UFW 指定端口范围。 例如，某些应用程序使用多个端口而不是单个端口。

例如，要允许使用端口`6000` - `6007` `X11`连接，请使用以下命令：

```
sudo ufw allow 6000:6007/tcp
sudo ufw allow 6000:6007/udp
```

使用 UFW 指定端口范围时，必须指定规则应适用的协议（ `tcp`或`udp` ）。 我们之前没有提到这一点，因为没有指定协议会自动允许两种协议，这在大多数情况下都可以。

### 特定的 IP 地址

使用 UFW 时，您还可以指定 IP 地址。 例如，如果要允许来自特定 IP 地址的连接（例如工作或家庭 IP 地址`203.0.113.4`，则需要指定 IP 地址，然后指定 IP 地址：

```
sudo ufw allow from 203.0.113.4
```

您还可以通过添加`to any port`后跟端口号`to any port`指定允许 IP 地址连接的特定端口。 例如，如果要允许`203.0.113.4`连接到端口`22` （SSH），请使用以下命令：

```
sudo ufw allow from 203.0.113.4 to any port 22
```

### 子网

如果要允许 IP 地址子网，可以使用 CIDR 表示法指定网络掩码。 例如，如果要允许所有 IP 地址范围从`203.0.113.1`到`203.0.113.254` ，则可以使用此命令：

```
sudo ufw allow from 203.0.113.0/24
```

同样，您也可以指定允许子网`203.0.113.0/24`连接的目标端口。 同样，我们将使用端口`22` （SSH）作为示例：

```
sudo ufw allow from 203.0.113.0/24 to any port 22
```

### 与特定网络接口的连接

如果要创建仅适用于特定网络接口的防火墙规则，可以通过指定`allow in on` ，然后指定网络接口的名称来执行此操作。

您可能希望在继续之前查找网络接口。 为此，请使用以下命令：

```
ip addr
```

```
Output2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state
. . .
3: eth1: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN group default
. . .
```

突出显示的输出表示网络接口名称。 它们通常被命名为`eth0`或`enp3s2` 。

例如，如果您的服务器具有名为`eth0`的公共网络接口，则可以使用以下命令允许 HTTP 流量：

```
sudo ufw allow in on eth0 to any port 80
```

这样做将允许您的服务器从公共互联网接收 HTTP 请求。

或者，如果您希望 MySQL 数据库服务器（端口`3306` ）监听专用网络接口`eth1`上的连接，则可以使用以下命令：

```
sudo ufw allow in on eth1 to any port 3306
```

这将允许专用网络上的其他服务器连接到 MySQL 数据库。

第 7 步 - 拒绝连接
------------

如果尚未更改传入连接的默认策略，则 UFW 配置为拒绝所有传入连接。 通常，这会通过要求您创建明确允许特定端口和 IP 地址的规则来简化创建安全防火墙策略的过程。

有时您会想要根据源 IP 地址或子网拒绝特定连接，但是，可能是因为您知道您的服务器正在受到攻击。 此外，如果要将默认传入策略更改为**允许** （不建议这样做），则需要为不希望允许连接的任何服务或 IP 地址创建**拒绝**规则。

要编写**拒绝**规则，您可以使用上述命令，将 **allow** 替换为 **deny** 。

例如，要拒绝 HTTP 连接，可以使用以下命令：

```
sudo ufw deny http
```

或者，如果要拒绝来自`203.0.113.4`所有连接，可以使用此命令：

```
sudo ufw deny from 203.0.113.4
```

现在让我们来看看如何删除规则。

第 8 步 - 删除规则
------------

了解如何删除防火墙规则与了解如何创建它们同样重要。 有两种方法可以指定要删除的规则：规则编号或规则本身。这与创建规则时的规则类似。 我们首先通过**规则编号**方法解释**删除** 。

### 按规则编号

如果您使用规则编号删除防火墙规则，那么您要做的第一件事就是获取防火墙规则列表。 UFW `status`命令具有`numbered`选项，该选项显示每个规则旁边的数字：

```
sudo ufw status numbered
```

```
OutputStatus: active

     To                         Action      From
     --                         ------      ----
[ 1] 22                         ALLOW IN    15.15.15.0/24
[ 2] 80                         ALLOW IN    Anywhere
```

如果我们决定要删除允许端口`80`上的 HTTP 连接的规则`2` ，我们可以在以下 UFW `delete`命令中指定：

```
sudo ufw delete 2
```

这将显示确认提示，您可以使用`y/n`回答。 输入`y`将删除规则`2` 。 请注意，如果启用了 IPv6，则还需要删除相应的 IPv6 规则。

### 按实际规则

规则编号的替代方法是指定要删除的实际规则。 例如，如果要删除`allow http`规则，可以这样写：

```
sudo ufw delete allow http
```

您还可以使用`allow 80`而不是服务名称指定规则：

```
sudo ufw delete allow 80
```

此方法将删除 IPv4 和 IPv6 规则（如果存在）。

第 9 步 - 检查 UFW 状态和规则
--------------------

您可以随时使用以下命令检查 UFW 的状态：

```
sudo ufw status verbose
```

如果禁用 UFW，这是默认设置，您将看到如下内容：

```
OutputStatus: inactive
```

如果 UFW 处于活动状态，如果您按照第 3 步进行操作，则输出将表明它处于活动状态并将列出您设置的所有规则。 例如，如果防火墙设置为允许来自任何地方的 SSH（端口`22` ）连接，则输出可能如下所示：

```
OutputStatus: active

To                         Action      From
--                         ------      ----
22/tcp                     ALLOW IN    Anywhere
```

如果要检查 UFW 如何配置防火墙，请使用`status`命令。

第 10 步 - 禁用或重置 UFW（可选）
----------------------

如果您决定不想使用 UFW，可以使用以下命令禁用它：

```
sudo ufw disable
```

您使用 UFW 创建的任何规则将不再处于活动状态。 如果您需要稍后激活，可以随时运行`sudo ufw enable` 。

如果您已经配置了 UFW 规则但是您决定要重新开始，则可以使用 reset 命令：

```
sudo ufw reset
```

这将禁用 UFW 并删除您之前定义的任何规则。 请注意，如果您在任何时候修改默认策略，默认策略都不会更改为原始设置。 这应该会让你重新开始使用 UFW。

结论
--

您的防火墙现在配置为允许（至少）SSH 连接。 确保允许服务器需要的任何其他传入连接，同时限制不必要的连接。这将确保您的服务器既实用又安全。

要了解更常见的 UFW 配置，请查看有关 [UFW Essentials：通用防火墙规则和命令的](https://www.howtoing.com/ufw-essentials-common-firewall-rules-and-commands/)本教程。