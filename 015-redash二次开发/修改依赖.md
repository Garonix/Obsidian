## patch-package 使用方法

### 1. 安装 patch-package 及 postinstall-hook

在你的项目根目录下执行：

```shell
yarn add patch-package postinstall-postinstall --dev
```

然后在 `package.json` 里加上一行（如果没有）：

```json
"scripts": {   "postinstall": "patch-package" }
```

这样以后每次 `npm install` 或 `yarn install` 后，都会自动应用补丁。

---

### 2. 修改 node_modules 里的依赖

比如你已经手动改了  
`node_modules/@redash/viz/src/visualizations/chart/Editor/ChartTypeSelect.tsx`  
和  
`viz-lib/src/visualizations/chart/plotly/prepareDefaultData.ts`  
等文件。

---

### 3. 生成 patch 补丁

在项目根目录下执行：

`npx patch-package @redash/viz npx patch-package viz-lib`

这样会在 `patches/` 目录下生成补丁文件，比如：  
`patches/@redash+viz+版本号.patch`  
`patches/viz-lib+版本号.patch`

---

### 4. 验证补丁生效

- 删除 `node_modules`，重新 `npm install`，你的所有自定义修改会自动恢复。
- 以后团队其他人/CI/CD 也能自动用上你的补丁。
- 记得**每次手动改完 node_modules 后都用 patch-package 生成一次补丁**。